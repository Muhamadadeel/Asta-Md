// ASTA MD


















































































































































































































































































































































































































































































































const ffmpeg=require('fluent-ffmpeg'),{randomBytes}=require('crypto'),fs=require('fs'),{getHttpStream,toBuffer}=require('@whiskeysockets/baileys'),sharp=require('sharp'),{spawn}=require('child_process'),path=require('path'),{fromBuffer}=require('file-type'),{tmpdir}=require('os'),ff=require('fluent-ffmpeg'),webp=require('node-webpmux');async function toGif(_0x4daa8f){try{const _0x2171e8='./'+randomBytes(0x3)['toString']('hex')+'.webp',_0x25a63f='./'+randomBytes(0x3)['toString']('hex')+'.gif';fs['writeFileSync'](_0x2171e8,_0x4daa8f['toString']('binary'),'binary');const _0x3cbf19=await new Promise(_0xa82288=>{spawn('convert',[_0x2171e8,_0x25a63f])['on']('error',_0x4514a5=>{throw _0x4514a5;})['on']('exit',()=>_0xa82288(_0x25a63f));});let _0x4d8473=fs['readFileSync'](_0x3cbf19);try{fs['unlinkSync'](_0x2171e8);}catch{}try{fs['unlinkSync'](_0x25a63f);}catch{}return _0x4d8473;}catch(_0x361fc4){console['log'](_0x361fc4);}}async function toMp4(_0x378068){try{let _0x18ead5='./'+randomBytes(0x3)['toString']('hex')+'.gif';const _0x318e64=fs['existsSync'](_0x378068)?_0x378068:save(_0x378068,_0x18ead5),_0x16ef92='./'+randomBytes(0x3)['toString']('hex')+'.mp4',_0x13def4=await new Promise(_0x28952a=>{ffmpeg(_0x318e64)['outputOptions'](['-pix_fmt\x20yuv420p','-c:v\x20libx264','-movflags\x20+faststart','-filter:v\x20crop=\x27floor(in_w/2)*2:floor(in_h/2)*2\x27'])['toFormat']('mp4')['noAudio']()['save'](_0x16ef92)['on']('exit',()=>_0x28952a(_0x16ef92));});let _0x405d9a=await fs['promises']['readFile'](_0x13def4);try{fs['unlinkSync'](_0x318e64);}catch{}try{fs['unlinkSync'](_0x16ef92);}catch{}return _0x405d9a;}catch(_0x189e4a){console['log'](_0x189e4a);}}const EightD=async _0x2d3a26=>{const _0x13ed46='./temp/'+randomBytes(0x3)['toString']('hex')+'.mp3';_0x2d3a26=Buffer['isBuffer'](_0x2d3a26)?save(_0x2d3a26,_0x13ed46):_0x2d3a26;const _0x2a5b65='./temp/'+randomBytes(0x3)['toString']('hex')+'.mp3',_0x5b6354=await new Promise(_0x33dffd=>{ffmpeg(_0x2d3a26)['audioFilter'](['apulsator=hz=0.125'])['audioFrequency'](0xac44)['audioChannels'](0x2)['audioBitrate']('128k')['audioCodec']('libmp3lame')['audioQuality'](0x5)['toFormat']('mp3')['save'](_0x2a5b65)['on']('end',()=>_0x33dffd(_0x2a5b65));});return _0x5b6354;};function save(_0x10ea77,_0x3e6bea='./temp/saveFile.jpg'){try{return fs['writeFileSync'](_0x3e6bea,_0x10ea77['toString']('binary'),'binary'),_0x3e6bea;}catch(_0x5be42a){console['log'](_0x5be42a);}}const resizeImage=(_0x104955,_0x2303b5,_0x4f31f8)=>{if(!Buffer['isBuffer'](_0x104955))throw'Input\x20is\x20not\x20a\x20Buffer';return new Promise(async _0x3cdac8=>{sharp(_0x104955)['resize'](_0x2303b5,_0x4f31f8,{'fit':'contain'})['toBuffer']()['then'](_0x3cdac8);});},_parseInput=async(_0x4aab81,_0x34a22b=![],_0x4e0bd5='path')=>{const _0x9a3a7d=await toBuffer(await getHttpStream(_0x4aab81)),_0x43a7f4='./temp/file_'+randomBytes(0x3)['toString']('hex')+'.'+(_0x34a22b?_0x34a22b:(await fromBuffer(_0x9a3a7d))['ext']),_0xc15996=Buffer['isBuffer'](_0x4aab81)?save(_0x4aab81,_0x43a7f4):fs['existsSync'](_0x4aab81)?_0x4aab81:_0x4aab81;if(_0x4e0bd5=='path')return _0xc15996;else{if(_0x4e0bd5=='buffer'){const _0x53b362=await fs['promises']['readFile'](_0xc15996);try{await fs['promises']['unlink'](_0xc15996);}catch(_0x47403d){}return _0x53b362;}}};async function imageToWebp(_0x560ec6){const _0x27436b=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp'),_0xf8be2e=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.jpg');fs['writeFileSync'](_0xf8be2e,_0x560ec6),await new Promise((_0x4b52b3,_0x232f98)=>{ff(_0xf8be2e)['on']('error',_0x232f98)['on']('end',()=>_0x4b52b3(!![]))['addOutputOptions'](['-vcodec','libwebp','-vf','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse'])['toFormat']('webp')['save'](_0x27436b);});const _0x5426d9=fs['readFileSync'](_0x27436b);return fs['unlinkSync'](_0x27436b),fs['unlinkSync'](_0xf8be2e),_0x5426d9;}async function videoToWebp(_0x36d5fe){const _0x169535=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp'),_0x352c6a=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.mp4');fs['writeFileSync'](_0x352c6a,_0x36d5fe),await new Promise((_0x1a27b8,_0x5287e4)=>{ff(_0x352c6a)['on']('error',_0x5287e4)['on']('end',()=>_0x1a27b8(!![]))['addOutputOptions'](['-vcodec','libwebp','-vf','scale=\x27min(320,iw)\x27:min\x27(320,ih)\x27:force_original_aspect_ratio=decrease,fps=15,\x20pad=320:320:-1:-1:color=white@0.0,\x20split\x20[a][b];\x20[a]\x20palettegen=reserve_transparent=on:transparency_color=ffffff\x20[p];\x20[b][p]\x20paletteuse','-loop','0','-ss','00:00:00','-t','00:00:05','-preset','default','-an','-vsync','0'])['toFormat']('webp')['save'](_0x169535);});const _0x462abe=fs['readFileSync'](_0x169535);return fs['unlinkSync'](_0x169535),fs['unlinkSync'](_0x352c6a),_0x462abe;}async function writeExifImg(_0x119b94,_0x2c6c66){let _0x3f9e65=await imageToWebp(_0x119b94);const _0x59ec89=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp'),_0x3a66ec=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp');fs['writeFileSync'](_0x59ec89,_0x3f9e65);if(_0x2c6c66['packname']||_0x2c6c66['author']){const _0x2af609=new webp['Image'](),_0x1ad6a5={'sticker-pack-id':'Asta-Md','sticker-pack-name':_0x2c6c66['packname'],'sticker-pack-publisher':_0x2c6c66['author'],'emojis':_0x2c6c66['categories']?_0x2c6c66['categories']:['']},_0x492d1a=Buffer['from']([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x1c05b7=Buffer['from'](JSON['stringify'](_0x1ad6a5),'utf-8'),_0x349c9a=Buffer['concat']([_0x492d1a,_0x1c05b7]);return _0x349c9a['writeUIntLE'](_0x1c05b7['length'],0xe,0x4),await _0x2af609['load'](_0x59ec89),fs['unlinkSync'](_0x59ec89),_0x2af609['exif']=_0x349c9a,await _0x2af609['save'](_0x3a66ec),_0x3a66ec;}}async function writeExifVid(_0x283ab3,_0x3f1d1b){let _0x331689=await videoToWebp(_0x283ab3);const _0x33ce4d=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp'),_0x42676c=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp');fs['writeFileSync'](_0x33ce4d,_0x331689);let _0x5926f6,_0x3c84d8;try{_0x5926f6=_0x3f1d1b['packname'];}catch(_0x237d6a){_0x5926f6='Asta-Md';}try{_0x3c84d8=_0x3f1d1b['author'];}catch(_0x789e35){_0x3c84d8='';}const _0x202b26=new webp['Image'](),_0x3320b8={'sticker-pack-id':'Asta-Md','sticker-pack-name':_0x5926f6,'sticker-pack-publisher':_0x3c84d8,'emojis':_0x3f1d1b['categories']?_0x3f1d1b['categories']:['']},_0x4ea01c=Buffer['from']([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x498b57=Buffer['from'](JSON['stringify'](_0x3320b8),'utf-8'),_0xf08ec=Buffer['concat']([_0x4ea01c,_0x498b57]);return _0xf08ec['writeUIntLE'](_0x498b57['length'],0xe,0x4),await _0x202b26['load'](_0x33ce4d),fs['unlinkSync'](_0x33ce4d),_0x202b26['exif']=_0xf08ec,await _0x202b26['save'](_0x42676c),_0x42676c;}async function writeExifWebp(_0x173cc0,_0x554e2f){const _0x251dc2=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp'),_0x52b933=path['join'](tmpdir(),randomBytes(0x6)['readUIntLE'](0x0,0x6)['toString'](0x24)+'.webp');fs['writeFileSync'](_0x251dc2,_0x173cc0);if(_0x554e2f['packname']||_0x554e2f['author']){const _0x476ba1=new webp['Image'](),_0x4c4e22={'sticker-pack-id':'Suhail_Md','sticker-pack-name':_0x554e2f['packname'],'sticker-pack-publisher':_0x554e2f['author'],'emojis':_0x554e2f['categories']?_0x554e2f['categories']:['']},_0x4c3662=await Buffer['from']([0x49,0x49,0x2a,0x0,0x8,0x0,0x0,0x0,0x1,0x0,0x41,0x57,0x7,0x0,0x0,0x0,0x0,0x0,0x16,0x0,0x0,0x0]),_0x464520=await Buffer['from'](JSON['stringify'](_0x4c4e22),'utf-8'),_0x4eefa6=await Buffer['concat']([_0x4c3662,_0x464520]);return await _0x4eefa6['writeUIntLE'](_0x464520['length'],0xe,0x4),await _0x476ba1['load'](_0x251dc2),fs['unlinkSync'](_0x251dc2),_0x476ba1['exif']=_0x4eefa6,await _0x476ba1['save'](_0x52b933),_0x52b933;}}module['exports']={'imageToWebp':imageToWebp,'videoToWebp':videoToWebp,'writeExifImg':writeExifImg,'writeExifVid':writeExifVid,'writeExifWebp':writeExifWebp,'toGif':toGif,'toMp4':toMp4,'EightD':EightD,'_parseInput':_parseInput,'resizeImage':resizeImage};